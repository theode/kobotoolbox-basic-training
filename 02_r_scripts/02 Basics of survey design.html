<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Derrick Theophille">
<meta name="dcterms.date" content="2024-05-05">

<title>02: Basics of survey design and questionnaire development</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="02 Basics of survey design_files/libs/clipboard/clipboard.min.js"></script>
<script src="02 Basics of survey design_files/libs/quarto-html/quarto.js"></script>
<script src="02 Basics of survey design_files/libs/quarto-html/popper.min.js"></script>
<script src="02 Basics of survey design_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="02 Basics of survey design_files/libs/quarto-html/anchor.min.js"></script>
<link href="02 Basics of survey design_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="02 Basics of survey design_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="02 Basics of survey design_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="02 Basics of survey design_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="02 Basics of survey design_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#surveys" id="toc-surveys" class="nav-link active" data-scroll-target="#surveys"><span class="header-section-number">1</span> Surveys</a>
  <ul class="collapse">
  <li><a href="#what-is-a-survey" id="toc-what-is-a-survey" class="nav-link" data-scroll-target="#what-is-a-survey"><span class="header-section-number">1.1</span> What is a survey?</a></li>
  <li><a href="#considerations-for-designing-a-survey" id="toc-considerations-for-designing-a-survey" class="nav-link" data-scroll-target="#considerations-for-designing-a-survey"><span class="header-section-number">1.2</span> Considerations for designing a survey</a>
  <ul class="collapse">
  <li><a href="#primary-and-secondary" id="toc-primary-and-secondary" class="nav-link" data-scroll-target="#primary-and-secondary"><span class="header-section-number">1.2.1</span> Primary and Secondary?</a></li>
  <li><a href="#the-why" id="toc-the-why" class="nav-link" data-scroll-target="#the-why"><span class="header-section-number">1.2.2</span> The <em>Why</em></a></li>
  <li><a href="#anything-else" id="toc-anything-else" class="nav-link" data-scroll-target="#anything-else"><span class="header-section-number">1.2.3</span> Anything else?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#questionnaires" id="toc-questionnaires" class="nav-link" data-scroll-target="#questionnaires"><span class="header-section-number">2</span> Questionnaires</a>
  <ul class="collapse">
  <li><a href="#what-is-a-questionnaire" id="toc-what-is-a-questionnaire" class="nav-link" data-scroll-target="#what-is-a-questionnaire"><span class="header-section-number">2.1</span> What is a questionnaire?</a></li>
  <li><a href="#types-of-questionnaires" id="toc-types-of-questionnaires" class="nav-link" data-scroll-target="#types-of-questionnaires"><span class="header-section-number">2.2</span> Types of questionnaires</a></li>
  <li><a href="#considerations-for-developing-a-questionnaire" id="toc-considerations-for-developing-a-questionnaire" class="nav-link" data-scroll-target="#considerations-for-developing-a-questionnaire"><span class="header-section-number">2.3</span> Considerations for developing a questionnaire</a></li>
  </ul></li>
  <li><a href="#question-review-and-pilot-testing" id="toc-question-review-and-pilot-testing" class="nav-link" data-scroll-target="#question-review-and-pilot-testing"><span class="header-section-number">3</span> Question review and pilot-testing</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">02: Basics of survey design and questionnaire development</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Derrick Theophille </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">05 May 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><img src="survey clipart.jpg" alt="Survey question." width="700"></p>
<section id="surveys" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Surveys</h1>
<section id="what-is-a-survey" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="what-is-a-survey"><span class="header-section-number">1.1</span> What is a survey?</h2>
<p>A survey can be defined as <strong>data collection where a portion of a population may be interviewed or sampled, using using specific, standard questions</strong>. The aim is usually <strong>to understand the population as whole</strong>. This is primary data collection.</p>
<p>A survey is usually administered in three main ways:</p>
<ol type="1">
<li>Face-to-face (in-person)</li>
<li>Over the phone (remote)</li>
<li>Self-administered</li>
</ol>
<p>Beyond this, the survey can involve traditional paper-based tools or more modern and electronic approaches. The methods employed beyond these can vary, based on several factors, such as the population to be studied and their geographic distribution, the resources available for conducting the survey, the amount of time available, and the types of questions to be asked and answered.</p>
<p>A survey can also vary in duration. <strong>Research surveys</strong>, for example usually have a short, defined period, after which the survey is ended. <strong>Monitoring surveys</strong> are longer or on-going indefinitely. A college student conducting a survey for their final paper will be doing research. An Agricultural Officer documenting crop establishments of her farmers is conducting a monitoring exercise. Both of these are surveys, but, as you might imagine, they are administered quite differently.</p>
<p>Herein is the crux of this section: <strong>Surveys and questionnaires may seem like pretty simple things to design and administer, however, there is plenty of room for misunderstandings and frustration to plague your survey exercise and derived results.</strong></p>
</section>
<section id="considerations-for-designing-a-survey" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="considerations-for-designing-a-survey"><span class="header-section-number">1.2</span> Considerations for designing a survey</h2>
<section id="primary-and-secondary" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="primary-and-secondary"><span class="header-section-number">1.2.1</span> Primary and Secondary?</h3>
<p>We’ve already discussed data sources, meaning primary and secondary data. This is the initial consideration when surveys are being designed. <strong>After all, the data you intend to gather may already exist!</strong> This can be beneficial as it may mean that your data collection activity might <em>simply</em> be a <strong>desk research</strong> exercise, collating and analyzing already existing data. It may also be beneficial if some of the already-existing data will not need to be collected by you, hence reducing the length and duration of your survey questionnaire. This will especially be the case if the secondary data is still “fresh” and relevant to the current survey goals.</p>
</section>
<section id="the-why" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="the-why"><span class="header-section-number">1.2.2</span> The <em>Why</em></h3>
<p>This leads us to having an understanding of the purpose of your survey. To an extent, this was also discussed previously. We might know why we need to collect some portion of data, but do we understand what the survey intends to accomplish? It is good to document the survey purpose so when the survey exercise is completed you may know whether you have accomplished what you set out to do from the beginning. Similarly, for ongoing surveys, we can have a means to verify that we are meeting our survey objectives.</p>
<p>In the case of the Fisheries Division’s <em>Fish Catch and Effort data collection programme</em>, an ongoing monitoring programme, our survey purpose is to <strong>account for and document fish landed (fish catch) and fishing activity (effort) at selected landing sites around Dominica for a given day</strong>.</p>
<p>With research surveys, we may need to define our research objectives at this point. This can be as simple as stating what we hope to achieve from the collected data.</p>
</section>
<section id="anything-else" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="anything-else"><span class="header-section-number">1.2.3</span> Anything else?</h3>
<p>Of course, there is a lot more to consider where surveys are concerned. This includes the population and sample size, questionnaire type and questions, tool for data gathering, whether enumerators will be required, and how many (and at what rate of pay), and how much time and money are available for the survey. If enumerators are needed, it is important to take the time to determine who would make suitable enumerators, recruit them and train them to administer the survey properly.</p>
<p><strong>All considerations help us in planning and tailoring the survey and its questions to fit that specific scenario while achieving the desired results.</strong> Ultimately, we should seek to have our survey support decision-making.</p>
</section>
</section>
</section>
<section id="questionnaires" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Questionnaires</h1>
<section id="what-is-a-questionnaire" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="what-is-a-questionnaire"><span class="header-section-number">2.1</span> What is a questionnaire?</h2>
<p><strong>A questionnaire is a survey tool consisting of a list of questions or prompts designed to gather data on a survey subject or respondent.</strong> Questionnaires are a standardized means of collecting data towards meeting a survey objective. This is the heart of your survey.</p>
<p>In preparation for this section, I learned that questionnaires may have originated, like most things in our modern world, from the ancient Greeks, who used questionnaires to gauge public opinion on a matter. Of course, questionnaires have applications in business (market research), academia, health care, and even government.</p>
</section>
<section id="types-of-questionnaires" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="types-of-questionnaires"><span class="header-section-number">2.2</span> Types of questionnaires</h2>
<p>Questionnaires come in many flavors. Broadly, these can include:</p>
<ol type="1">
<li><strong>Structured and close-ended</strong>: The questions are usually closed-ended in a fixed format with predetermined response options. The respondent can only respond with the pre-determined options presented by the enumerator. Allows for the capture of quantitative data.</li>
<li><strong>Unstructured and open-ended</strong>: The questions are open-ended, not in a fixed format and are not pre-determined. The respondent is encouraged to respond in their own words. Provides a lot of insight into the opinions an attitudes of the respondent, more difficult to analyse and summarize. Allows for the capture of qualitative data.</li>
<li><strong>Mixed</strong>: This questionnaire has both open- and closed-ended questions. This allows for more flexibility in the responses received as both quantitative and qualitative data may be captured simultaneously.</li>
</ol>
</section>
<section id="considerations-for-developing-a-questionnaire" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="considerations-for-developing-a-questionnaire"><span class="header-section-number">2.3</span> Considerations for developing a questionnaire</h2>
<p>Before proceeding with questionnaire writing we should do the following:</p>
<ul>
<li>Determine what information you need to know.</li>
<li>Have some idea how the data to be collected can be analysed.</li>
<li>Categorize and organize the data you plan to collect with your questionnaire.</li>
</ul>
<p>Concerning questionnaire structure, consider the following:</p>
<ul>
<li>Begin the questionnaire with simple and easy to answer questions. If you will need to ask sensitive questions, save those for later.</li>
<li>Likewise, order questions from those which are more general in scope to those which are more specific.</li>
<li>Transition statements are useful when jumping between groups of questions, for example when you are changing from one subject area to another.</li>
</ul>
<p>Concerning the questions themselves, consider the following:</p>
<ul>
<li>Questions should be clear:
<ul>
<li>There should be no ambiguity what is being asked and what sort of response is required.</li>
<li>Words and phrases should be precise.</li>
<li>Formatting can be used to place emphasis on key words or phrases (i.e.&nbsp;bold, italics, underlining, capitalization or highlighting).</li>
<li>Units of measure should be stated. Ask one question at a time.</li>
</ul></li>
<li>Questions should be answerable:
<ul>
<li>Do not ask people for information they do not have.</li>
<li>When in doubt as to whether a question is answerable, you can include the option <em>“don’t know”</em> as a valid response.</li>
<li>Do not ask people to recall things over extensive time periods where memory is sure to fail.</li>
</ul></li>
<li>Make questions easy:
<ul>
<li>A good rule of thumb is to keep questions under 25 words long.</li>
<li>Do not ask for more detail than you need.</li>
<li>Where necessary, ask for <em>approximate</em> or <em>“best estimate”</em> or <em>“as best as you can recall”</em> responses.</li>
<li>Keep things simple, and as much as possible, keep the questionnaire short.</li>
</ul></li>
<li>Keep your questions unbiased:
<ul>
<li>Do not say things to the respondent which will influence their responses.</li>
<li>Reassure the respondent that negative, positive and neutral responses are equally valid responses.</li>
<li>Answer choices can be randomized to reduce the possibility of bias. Electronic forms are great at this.</li>
<li>Sensitive questions can be asked in a disguised manner, or perhaps in a way where the focus is not strictly on the respondent, but on the wider group to which the respondent belongs, or analogue questions may be asked instead.</li>
</ul></li>
</ul>
</section>
</section>
<section id="question-review-and-pilot-testing" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Question review and pilot-testing</h1>
<p>Believe it or not, after your survey is designed and your questionnaire is drafted, we are still not yet ready to go out there and collect that sweet, sweet data! We are now at the review stage. Review gives us the opportunity to ensure that the questionnaire will work as intended, and will not befuddle our respondents, frustrate our enumerators, add to our stress levels, as survey leads, or disappoint our higher-ups when we finally give them the resulting information. We need to maximize the possibility that respondents will participate and the responses received are clear and unambiguous.</p>
<p>Pilot-testing the questionnaire helps with this review process. This involves doing mock trials of the interview or self-administered survey. Here are a few things to look out for when reviewing the questionnaire:</p>
<ul>
<li>Are respondents willing to answer the questions in the form you propose to use?</li>
<li>What are the country- or region-specific response categories?</li>
<li>Are any of the questions particularly difficult or sensitive?
<ul>
<li>Do interviewers understand the questions?</li>
<li>Extra training can focus on these questions.</li>
</ul></li>
<li>Do the respondents misinterpret the questions? Are any of the words ambiguous or difficult to understand?
<ul>
<li>Are there any questions which require changes in wording or improved translation?</li>
<li>Are the questions understood by all classes of respondent?</li>
</ul></li>
<li>Does the questionnaire flow smoothly?
<ul>
<li>Are the questions placed in the best order?</li>
</ul></li>
<li>Can the enumerators follow the instructions easily?
<ul>
<li>Are the instructions to enumerators adequate?</li>
</ul></li>
<li>Whether additional training for enumerators, instrument administrators, experimenters, coders, and data editors are necessary?</li>
<li>The pre-test should show where the format needs to be improved before the final questionnaire is printed or deployed.</li>
<li>Is it necessary to create new options for common answers that were not included in the original questionnaires?</li>
<li>How long does an interview take?
<ul>
<li>The answer to this question will help you decide how many interviewers are needed and how long the fieldwork will take.</li>
</ul></li>
<li>Are there any ethical considerations that were overlooked?</li>
<li>Is the sampling method appropriate and feasible?</li>
<li>Whether additional or specifying questions are needed or whether some questions should be eliminated.</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>